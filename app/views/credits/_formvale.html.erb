

<div ng-controller="solicitud" >
  <div id="errores" style="background-color:#f0f0ff;border-size:2px;border-style:solid;z-index:99;overflow-y: scroll;">
    <div>
      
      <%= form_for @credit,class:"father" do |f| %>
      
    <% if @credit.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@credit.errors.count, "error") %> prohibited this credit from being saved:</h2>
  
        <ul>
        <% @credit.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
      <input type="button" onclick="$('#errores').hide()" value="Cerrar">
    </div>
  </div>
  
  

  
<div id="father" style='position:relative; background-image: url("<%= image_path("MarjoVale.png")%>");
  background-size: 1300px 1900px; 
  background-repeat: no-repeat;
  margin-left: 0px;
  '>
  
  
  
  <input type="hidden" value = "<%= @credit.to_json%>" ng-model="credito" ng-init="credito  = <%= @credit.to_json%>">
      
     
  
<div style = "position:relative; margin-left:45px; margin-top:0px; ">
      <div style="top:10px;left:1000px;position:absolute;">
        <p>
          <%= f.radio_button  :agente_empresa,1,checked:true,"value":true,"ng-model":"credito.agente_empresa","ng-disabled":"block","ng-change":"agente_o_empresa()"%> <%= f.label "#{:agente_empresa}_true", "Agente" %>
          <%= f.radio_button  :agente_empresa,0,"ng-model":"credito.agente_empresa","ng-disabled":"block","ng-change":"agente_o_empresa()"%> <%= f.label "#{:agente_empresa}_false", "Empresa" %>
        </p>
      </div>
       
      
      <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br><br><br><br><br><br><br><br>
      <br><br><br><br><br>
      
     
      
      
    <div class ="row">
      <div class="input-field col s12 m3 l3">
        <select id="credit_referencia_agente_empresa" name="credit[referencia_agente_empresa]"class="browser-default" ng-model="credito.referencia_agente_empresa" ng-disabled="block" style="left:1000px;top:58px;position:absolute;",ng-disabled="block">
            <option value="" disabled selected>{{tipo}}</option>
            <option ng-repeat="option in agentEmp" value="{{option.id}}">{{option.nombre}}</option>
        </select>
      </div>
     
    </div>
    <div class="row">
      <div class="input-field col s12 m3 l3 offset-s0 offset-m9 offset-l9">
        <%= f.text_field :fecha, class:"datepicker", class:"cerrar_bloquear",type:"date", autocomplete: "off",:style=>"left:1010px;top:105px;position:absolute;" %>
      </div>
    </div>
    
    
    <!--div class="row">
      <div>
        <!--%= f.hidden_field :CURP,:style=>"position:absolute;top:600px;left:70px;width:300px;height:18px;","ng-model":"credito.CURP","ng-change":"buscarCliente()","ng-disabled":"block"%>
      </div>
      <div-->
        <!--%= f.hidden_field :seguro,:style=>"position:absolute;top:600px;left:400px;width:220px;height:18px;","ng-model":"credito.seguro","ng-disabled":"block"%>
      </div>
      <div>
        <!--%= f.hidden_field :INE,:style=>"position:absolute;top:600px;left:650px;width:180px;height:18px;","ng-model":"credito.INE" ,"ng-disabled":"block"%>
      </div-->
      
      <!--div style="position:absolute;top:600px;left:950px;">
          <!--%= f.radio_button  :fiel,1,checked:true,:style=>"position:absolute;top:-46px;left:-36px;","ng-model":"credito.fiel" ,"ng-disabled":"block"%-->
          <!--%= f.radio_button  :fiel,0,:style=>"position:absolute;top:-46px;left:43px;","ng-model":"credito.fiel","ng-disabled":"block"%-->
      </div-->

      <!--div>
        <!--%= f.hidden_field :nacionalidad,:style=>"position:absolute;top:620px;left:950px;width:180px;height:18px;","ng-model":"credito.nacionalidad" ,"ng-disabled":"block"%>
      </div>
    </div-->
    
 
    <div class="row">
      <div class="input-field col s12 m2 l2">
        <%= f.text_field :apellido_paterno,:style=>"position:absolute;top:205px;left:100px;width:150px;height:18px;","ng-model":"credito.apellido_paterno","ng-change":"buscarCliente()" ,"ng-disabled":"block"%>
      </div>
      <div class="input-field col s12 m2 l2">
        <%= f.text_field :apellido_materno,:style=>"position:absolute;top:205px;left:420px;width:180px;height:18px;" ,"ng-model":"credito.apellido_materno","ng-change":"buscarCliente()","ng-disabled":"block"%>
      </div>
      <div class="input-field col s12 m2 l2">
        <%= f.text_field :nombre_1,:style=>"position:absolute;top:205px;left:800px;width:150px;height:18px;","ng-model":"credito.nombre_1","ng-change":"buscarCliente()" ,"ng-disabled":"block"%>
      </div>
      <div class="input-field col s12 m2 l2">
        <%= f.text_field :nombre_2,:style=>"position:absolute;top:205px;left:960px;width:200px;height:18px;","ng-model":"credito.nombre_2","ng-change":"buscarCliente()","ng-disabled":"block" %>
      </div>
      <!--div class="input-field col s12 m4 l4">
        <!--%= f.hidden_field :RFC,:style=>"position:absolute;top:600px;left:870px;width:250px;height:18px;","ng-model":"credito.RFC" ,"ng-disabled":"block"%>
        <!--%= form.hidden_field :RFC, :style=>"position:absolute;top:600px;left:870px;width:250px;height:18px;","ng-model":"credito.RFC" ,"ng-disabled":"block"%>        
      </div-->
    </div>
    <div class="row">
          <div style="position:absolute;top:-55px;left:120px;font-size: 30px; font-weight: bold">
          <%= f.radio_button  :vale,1,checked:true,"value":true%> 
          <%= f.label "#{:vale}_true", "Vale"%>
      </div>

    </div>

    <div class="row">
      <div>
        <%= f.text_field :calle, :style=>"position:absolute;top:292px;left:60px;width:700px;height:18px;","ng-model":"credito.calle","ng-disabled":"block" %>
      </div>
     
      <div>
        <%= f.number_field :numero_exterior, :style=>"position:absolute;top:292px;left:990px;width:100px;height:18px;","ng-model":"credito.numero_exterior","ng-disabled":"block" %>
      </div>
       <div>
        <%= f.text_field :numero_interior, :style=>"position:absolute;top:292px;left:1120px;width:100px;height:18px;" ,"ng-model":"credito.numero_interior","ng-disabled":"block"%>
      </div>
    </div>
    <div class="row">
     
      <div class="input-field col s12 m3 l3">
        <%= f.text_field :codigo_postal, :style=>"position:absolute;top:340px;left:35px;width:70px;height:18px;","ng-model":"codigo", "ng-blur":"type()","ng-model":"credito.codigo_postal","ng-disabled":"block"%>
      </div>
      <div class="input-field col s12 m3 l3">
        <select id="credit_colonia" name="credit[colonia]"class="browser-default" ng-model="credito.colonia" style="position:absolute;top:345px;left:280px;width:340px;height:18px;",ng-disabled="block">
             <option value="" disabled selected>Colonia</option>
            <option ng-repeat="option in data.zip_codes" value="{{option.d_asenta}}">{{option.d_asenta}}</option>
        </select>
      </div>
      <div class="input-field col s12 m3 l3">
        <select id="credit_localidad" name="credit[localidad]"class="browser-default" ng-model="credito.localidad" style="position:absolute;top:345px;left:720px;width:250px;height:18px;",ng-disabled="block">
            <option value="" disabled selected>Localidad</option>
             <option ng-repeat="option in data.zip_codes" value="{{option.d_mnpio}}">{{option.d_mnpio}}</option>
        </select>
      </div>
    </div>
    <div class="row">
          <div class="input-field col s12 m3 l3">
         <%=f.text_field :estado_actual, :style=>"position:absolute;top:340px;left:1000px;width:200px;height:18px;","ng-model":"data.zip_codes[0].d_estado","ng-disabled":"block"%>
      </div>
      
    
    <div class="row">
      <div class="input-field col s12 m3 l3">
        <%= f.text_field :monto_solicitud,:style=>"position:absolute;top:420px;left:15px;width:150px;height:25px;","ng-model":"credito.monto_solicitud","ng-disabled":"block"%>
      </div>
      
    </div>
    
   
     <div class="row">
      
      <div class="row col s12 m4 l4">
       <div style="top:430px;left:350px;position:absolute;">
          <!--%=f.collection_select(:product_id,Product.all,:id,:nombre_del_producto,{:prompt => 'Productos:'},{"ng-disabled":"block"})%-->
          <%= f.collection_select :produc_id, Product.all, :id, :nombre_del_producto, :prompt => 'Productos:', :selected => 2 %>
        <!--%=f.collection_select(:destination_id,Destination.all,:id,:descricion,{:prompt => 'Destino del credito:'},{"ng-disabled":"block"})%-->
        </div>
        <br>
        <br>
        <a href="{{credito.pdfs}}" target="_blank" , style="top:480px;left:350px;position:absolute;" "boder-radius:20px;padding:20px 10px;background-color:orange;color:white" id="pdfs">mostrar pdfs</a>
      </div>
    </div>
  </div>
    </div>
    
    <!--div class="actions" id="solo_en_new"-->
      <div class="input-field col s12">
         <div class="field">
            <%= f.label :pdf64,"cargar PDF", :style=>"position:absolute;top:460px;left:350px;width:200px;height:30px"%><br>
            <input type="file" id="filePicker" onchange="previewFile()" accept=".pdf" max-size="2024" style="position:absolute;top:480px;left:350px;width:300px;height:30px">
            <input id="base64textarea" type='hidden' name="credit[pdf64]" cols="50" rows="15" style="position:absolute;top:480px;left:350px;width:200px;height:30px">
          </div>
          <script>
          
          var uploadField = document.getElementById("filePicker");

          uploadField.onchange = function() {
              if(this.files[0].size > 3000000){
                 alert("El pdf es muy grande favor de reducir la resolucion del escaner");
                 this.value = "";
                 preview.src = "";
              }else{
                previewFile();
              }
              console.log(this.value);
              
          };
            var cacas = "";
             function previewFile() {
             $("#submitid").prop('disabled', false);
            var preview = $('#base64textarea');
            var file    = document.querySelector('input[type=file]').files[0];
            var reader  = new FileReader();
            
            reader.onloadend = function () {
              $("#submitid").prop('disabled', false);
              preview.val(reader.result);
              $("#submitid").prop('disabled', false);
            }
          
            if (file) {
              reader.readAsDataURL(file);
              alert("El archivo pdf se ha procesado correctamente");
            } else {
              preview.src = "";
              uploadField = "";
              alert("Error al procesar pdf, intente cargarlo nuevamente");
            }
          }
        </script>
      <!--/div-->
      <%= f.submit "Guardar",id:"submitid",:style=>"position:absolute;top:500px;left:350px;width:60px;height:30px"%>
    </div>
  <% end %>
  <div id="autorelleno" style="background-color:#f0f0ff;width:700px;position:fixed;top:100px;left:100px;border-size:2px;border-style:solid">
        <div>
          Ingrese curp: <input type="text" ng-model="credit.CURP" ng-change="buscarCliente(false)" id="curp_buscador">
          <table border="1">
            <input type="button" value="Cerrar" ng-click="ocultar()">
            <tr>
              <th>Apellido Paterno</th>
              <th>Apellido Materno</th>
              <th>Nombre 1</th>
              <th>Nombre 2</th>
              <th>Curp</th>
              <th>Selecionar</th>
            </tr>
            <tbody>
              <tr ng-repeat="cliente_a in clientes">
                <td>
                  {{cliente_a.apellido_paterno}}
                </td>
                <td>
                  {{cliente_a.apellido_materno}}
                </td>
                <td>
                  {{cliente_a.nombre_1}}
                </td>
                <td>
                  {{cliente_a.nombre_2}}
                </td>
                <td>
                  {{cliente_a.CURP}}
                </td>
                <td>
                  <input type="button" value="Rellenar" ng-click="rellenar(cliente_a)">
                </td>
              </tr>
            </tbody>
          </table>
          
        </div>
      </div>
      <%if @retorno == "2"%>
          <%= link_to 'ATRAAS', "/customers/#{@credit.customer_id}/historial",class:"waves-effect waves-light btn" %>
      <%else%>
          <a href="/view_credits">Atras</a>
      <%end%>


</div>  
</div> 

